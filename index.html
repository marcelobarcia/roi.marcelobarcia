<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de ROI RPA - Marcelo Barcia</title>
    
    <!-- Scripts de Librerías (CDNs) -->
    <!-- Nota: El orden es importante para que Recharts encuentre a React -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    
    <!-- Configuración de Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    borderRadius: {
                        '3xl': '1.5rem',
                        '4xl': '2rem',
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="bg-[#f8fafc]">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, Fragment } = React;
        const { 
            ResponsiveContainer, ComposedChart, Area, Line, XAxis, YAxis, CartesianGrid, Tooltip 
        } = Recharts;

        // Iconos Inline SVG corregidos con Fragmentos para evitar errores de JSX
        const Icon = ({ name, size = 20, className = "" }) => {
            const icons = {
                calculator: <path d="M6 2h12a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm0 2v16h12V4H6zm3 3h2v2H9V7zm4 0h2v2h-2V7zm-4 4h2v2H9v-2zm4 0h2v2h-2v-2zm-4 4h2v2H9v-2zm4 0h2v2h-2v-2z"/>,
                clock: <path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2zm0 18a8 8 0 1 1 8-8 8 8 0 0 1-8 8zm1-8h-1V7h2v4h3v2h-4z"/>,
                dollar: <path d="M12 1v22m5-18H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H7"/>,
                trending: <Fragment><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><path d="M17 6h6v6"/></Fragment>,
                plus: <Fragment><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></Fragment>,
                trash: <path d="M3 6h18m-2 0v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6m3 0V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>,
                settings: <Fragment><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></Fragment>,
                linkedin: <Fragment><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></Fragment>,
                external: <Fragment><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></Fragment>,
                calendar: <Fragment><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></Fragment>
            };
            return (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name]}
                </svg>
            );
        };

        const App = () => {
            const [licenseCost, setLicenseCost] = useState(12000000); 
            const [serviceCost, setServiceCost] = useState(13000000); 
            const [hourlyRate, setHourlyRate] = useState(25000); 
            const [monthlyMaintenance, setMonthlyMaintenance] = useState(450000); 
            const [tasks, setTasks] = useState([
                { id: 1, name: 'Procesamiento de Facturas', hours: 160, autoPercent: 80 },
                { id: 2, name: 'Conciliación de Cuentas', hours: 80, autoPercent: 90 }
            ]);
            const [showSettings, setShowSettings] = useState(false);

            const formatCLP = (val) => new Intl.NumberFormat('es-CL', { style: 'currency', currency: 'CLP', maximumFractionDigits: 0 }).format(val);
            const formatNum = (val) => new Intl.NumberFormat('es-CL').format(val);

            const results = useMemo(() => {
                const totalInvestment = licenseCost + serviceCost;
                const taskDetails = tasks.map(t => {
                    const hoursSavedMonthly = t.hours * (t.autoPercent / 100);
                    const hoursSavedAnnual = hoursSavedMonthly * 12;
                    const moneySavedMonthly = hoursSavedMonthly * hourlyRate;
                    return { ...t, moneySavedMonthly, hoursSavedMonthly, hoursSavedAnnual };
                });
                const totalMonthlySaving = taskDetails.reduce((acc, t) => acc + t.moneySavedMonthly, 0);
                const totalAnnualHoursSaved = taskDetails.reduce((acc, t) => acc + t.hoursSavedAnnual, 0);
                const netMonthlyBenefit = totalMonthlySaving - monthlyMaintenance;
                const paybackMonths = netMonthlyBenefit > 0 ? Math.ceil(totalInvestment / netMonthlyBenefit) : '∞';
                
                const chartData = [];
                for (let i = 0; i <= 24; i++) {
                    const benefitAcc = i === 0 ? 0 : netMonthlyBenefit * i;
                    chartData.push({ mes: `Mes ${i}`, num: i, inversion: totalInvestment, ahorroAcumulado: benefitAcc });
                }
                return { totalInvestment, totalMonthlySaving, totalAnnualHoursSaved, netMonthlyBenefit, paybackMonths, chartData, taskDetails };
            }, [tasks, hourlyRate, licenseCost, serviceCost, monthlyMaintenance]);

            const updateTask = (id, field, value) => {
                setTasks(tasks.map(t => t.id === id ? { ...t, [field]: value } : t));
            };

            return (
                <div className="min-h-screen p-4 md:p-8">
                    <div className="max-w-6xl mx-auto mb-8 flex flex-col md:flex-row md:items-center justify-between gap-6">
                        <div>
                            <h1 className="text-3xl font-black text-slate-900 flex items-center gap-3">
                                <div className="bg-blue-600 p-2 rounded-xl text-white"><Icon name="calculator" /></div>
                                Calculadora de ROI RPA
                            </h1>
                            <p className="text-slate-500 font-medium">Modelamiento financiero por Marcelo Barcia</p>
                        </div>
                        <button onClick={() => setShowSettings(!showSettings)} className="flex items-center gap-2 px-5 py-2.5 rounded-2xl text-sm font-bold bg-white text-slate-600 border border-slate-200 shadow-sm hover:bg-slate-50 transition-all">
                            <Icon name="settings" size={18} /> {showSettings ? 'Cerrar Ajustes' : 'Configurar Inversión'}
                        </button>
                    </div>

                    <div className="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8">
                        <div className="lg:col-span-5 space-y-6">
                            {showSettings && (
                                <div className="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm">
                                    <h2 className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-6">Detalle Inversión Inicial</h2>
                                    <div className="space-y-4">
                                        <div className="flex justify-between items-center px-1"><label className="text-[10px] font-black text-slate-400 uppercase">Licencias</label><span className="text-[10px] font-bold text-blue-500 bg-blue-50 px-2 rounded-full">{formatNum(licenseCost)}</span></div>
                                        <input type="number" className="w-full bg-slate-50 border border-slate-200 rounded-xl py-2 px-4 text-sm font-bold outline-none focus:border-blue-500" value={licenseCost} onChange={(e) => setLicenseCost(Number(e.target.value))} />
                                        <div className="flex justify-between items-center px-1"><label className="text-[10px] font-black text-slate-400 uppercase">Implementación</label><span className="text-[10px] font-bold text-blue-500 bg-blue-50 px-2 rounded-full">{formatNum(serviceCost)}</span></div>
                                        <input type="number" className="w-full bg-slate-50 border border-slate-200 rounded-xl py-2 px-4 text-sm font-bold outline-none focus:border-blue-500" value={serviceCost} onChange={(e) => setServiceCost(Number(e.target.value))} />
                                        <div className="pt-2 border-t border-slate-100 flex justify-between items-center px-1"><label className="text-[10px] font-black text-slate-400 uppercase">Mantenimiento Mensual</label><span className="text-[10px] font-bold text-blue-500 bg-blue-50 px-2 rounded-full">{formatNum(monthlyMaintenance)}</span></div>
                                        <input type="number" className="w-full bg-slate-50 border border-slate-200 rounded-xl py-2 px-4 text-sm font-bold outline-none focus:border-blue-500" value={monthlyMaintenance} onChange={(e) => setMonthlyMaintenance(Number(e.target.value))} />
                                    </div>
                                </div>
                            )}

                            <div className="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm">
                                <label className="text-[10px] font-black text-slate-400 uppercase mb-2 block">Costo Hora Hombre Promedio (FTE)</label>
                                <input type="number" className="w-full bg-slate-50 border border-slate-200 rounded-xl py-2 px-4 text-sm font-bold outline-none focus:border-blue-500" value={hourlyRate} onChange={(e) => setHourlyRate(Number(e.target.value))} />
                            </div>

                            <div className="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-xs font-black text-slate-400 uppercase tracking-widest">Procesos</h2>
                                    <button onClick={() => setTasks([...tasks, { id: Date.now(), name: 'Nuevo Proceso', hours: 40, autoPercent: 80 }])} className="bg-blue-50 text-blue-600 p-2 rounded-full hover:bg-blue-100"><Icon name="plus" size={16} /></button>
                                </div>
                                <div className="space-y-4">
                                    {results.taskDetails.map(task => (
                                        <div key={task.id} className="p-4 bg-slate-50 rounded-2xl border border-slate-100 relative">
                                            <button onClick={() => setTasks(tasks.filter(t => t.id !== task.id))} className="absolute top-2 right-2 text-slate-300 hover:text-red-500"><Icon name="trash" size={14} /></button>
                                            <input className="bg-transparent font-bold text-slate-800 text-sm outline-none border-b border-transparent focus:border-blue-400 w-full mb-3" value={task.name} onChange={(e) => updateTask(task.id, 'name', e.target.value)} />
                                            <div className="grid grid-cols-2 gap-4">
                                                <div><label className="text-[9px] font-black text-slate-400 uppercase">Hrs/Mes</label><input type="number" className="w-full bg-white border border-slate-200 rounded-lg px-2 py-1 text-xs font-bold" value={task.hours} onChange={(e) => updateTask(task.id, 'hours', Number(e.target.value))} /></div>
                                                <div><label className="text-[9px] font-black text-slate-400 uppercase">% Auto</label><select className="w-full bg-white border border-slate-200 rounded-lg px-2 py-1 text-xs font-bold outline-none" value={task.autoPercent} onChange={(e) => updateTask(task.id, 'autoPercent', Number(e.target.value))}><option value={50}>50%</option><option value={80}>80%</option><option value={95}>95%</option></select></div>
                                            </div>
                                            <div className="mt-3 flex justify-between items-center bg-white p-2 rounded-xl border border-slate-100 text-[10px] font-bold">
                                                <span className="text-slate-400 uppercase">Liberado:</span>
                                                <span className="text-blue-600">{formatNum(Math.round(task.hoursSavedAnnual))} hrs/año</span>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>

                        <div className="lg:col-span-7 space-y-6">
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div className="bg-blue-600 p-8 rounded-[2.5rem] text-white shadow-xl shadow-blue-100 relative overflow-hidden">
                                    <p className="text-blue-200 font-bold uppercase tracking-wider text-xs mb-2">Punto de Equilibrio</p>
                                    <h3 className="text-4xl font-black mb-2">{results.paybackMonths} Meses</h3>
                                    <Icon name="trending" size={100} className="absolute -bottom-4 -right-4 text-white/10" />
                                </div>
                                <div className="bg-white p-8 rounded-[2.5rem] border border-slate-200 shadow-sm">
                                    <p className="text-slate-400 font-bold uppercase tracking-wider text-xs mb-2">Ahorro Anual Neto</p>
                                    <h3 className="text-4xl font-black mb-2 text-emerald-600">{formatCLP(results.netMonthlyBenefit * 12)}</h3>
                                    <p className="text-slate-400 text-xs font-bold uppercase">Incluye costo OPEX</p>
                                </div>
                            </div>

                            <div className="bg-white p-8 rounded-[2.5rem] border border-slate-200 shadow-sm">
                                <h2 className="text-lg font-black text-slate-800 mb-8 uppercase tracking-tight">Curva de Amortización</h2>
                                <div className="h-[300px]">
                                    <ResponsiveContainer width="100%" height="100%">
                                        <ComposedChart data={results.chartData}>
                                            <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f1f5f9" />
                                            <XAxis dataKey="num" axisLine={false} tickLine={false} tick={{fontSize: 10, fontWeight: 700}} dy={10} />
                                            <YAxis tickFormatter={(v) => `$${v/1000000}M`} axisLine={false} tickLine={false} tick={{fontSize: 10, fontWeight: 700}} />
                                            <Tooltip formatter={(v) => formatCLP(v)} />
                                            <Area type="monotone" dataKey="ahorroAcumulado" fill="#2563eb" fillOpacity={0.1} stroke="#2563eb" strokeWidth={4} />
                                            <Line type="monotone" dataKey="inversion" stroke="#cbd5e1" strokeWidth={2} strokeDasharray="10 5" dot={false} />
                                        </ComposedChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>

                            <footer className="pt-10 border-t border-slate-200 flex flex-col items-center">
                                <p className="text-slate-400 text-[10px] font-black uppercase mb-4 tracking-widest">Desarrollado por</p>
                                <a href="https://www.linkedin.com/in/marcelobarcia/" target="_blank" className="flex items-center gap-3 bg-white border border-slate-200 px-6 py-3 rounded-2xl shadow-sm hover:shadow-md hover:border-blue-400 transition-all">
                                    <div className="bg-[#0077B5] p-2 rounded-lg text-white"><Icon name="linkedin" size={20} /></div>
                                    <div className="flex flex-col">
                                        <span className="text-slate-900 font-black text-sm">Marcelo Barcia</span>
                                        <span className="text-[10px] text-slate-400 font-bold flex items-center gap-1 uppercase tracking-tighter">LinkedIn Profile <Icon name="external" size={10} /></span>
                                    </div>
                                </a>
                            </footer>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
